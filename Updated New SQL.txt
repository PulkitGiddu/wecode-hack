CREATE TABLE users (
    user_id UUID PRIMARY KEY,

    name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20),

    role VARCHAR(20) NOT NULL
        CHECK (role IN ('ADMIN', 'MANAGER', 'MEMBER')),

    credits INTEGER DEFAULT 0 CHECK (credits >= 0),

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE meeting_rooms (
    room_id UUID PRIMARY KEY,

    room_name VARCHAR(100) UNIQUE NOT NULL,
    seating_capacity INTEGER NOT NULL CHECK (seating_capacity > 0),

    projector BOOLEAN DEFAULT FALSE,
    wifi BOOLEAN DEFAULT FALSE,
    conference_call BOOLEAN DEFAULT FALSE,
    whiteboard BOOLEAN DEFAULT FALSE,
    water_dispenser BOOLEAN DEFAULT FALSE,
    tv BOOLEAN DEFAULT FALSE,
    coffee_machine BOOLEAN DEFAULT FALSE,

    is_active BOOLEAN DEFAULT TRUE,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE bookings (
    booking_id UUID PRIMARY KEY,

    room_id UUID NOT NULL,
    user_id UUID NOT NULL,

    meeting_title VARCHAR(200) NOT NULL,
    meeting_type VARCHAR(20) NOT NULL
        CHECK (meeting_type IN ('CLASSROOM', 'ONLINE', 'CONFERENCE', 'BUSINESS')),

    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,

    total_credits INTEGER NOT NULL CHECK (total_credits >= 0),

    status VARCHAR(20) DEFAULT 'ACTIVE'
        CHECK (status IN ('ACTIVE', 'CANCELLED')),

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    cancelled_at TIMESTAMP,

    CONSTRAINT fk_booking_room
        FOREIGN KEY (room_id)
        REFERENCES meeting_rooms(room_id),

    CONSTRAINT fk_booking_user
        FOREIGN KEY (user_id)
        REFERENCES users(user_id),

    CONSTRAINT chk_booking_time
        CHECK (end_time > start_time)
);


CREATE TABLE credit_transactions (
    transaction_id UUID PRIMARY KEY,

    user_id UUID NOT NULL,
    booking_id UUID,

    amount INTEGER NOT NULL,

    transaction_type VARCHAR(20) NOT NULL
        CHECK (transaction_type IN ('BOOKING', 'REFUND', 'RESET')),

    description VARCHAR(255),

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_transaction_user
        FOREIGN KEY (user_id)
        REFERENCES users(user_id),

    CONSTRAINT fk_transaction_booking
        FOREIGN KEY (booking_id)
        REFERENCES bookings(booking_id)
);


CREATE TABLE room_schedule (
    schedule_id UUID PRIMARY KEY,

    booking_id UUID UNIQUE NOT NULL,
    room_id UUID NOT NULL,
    booked_by UUID NOT NULL,

    room_name VARCHAR(100) NOT NULL,
    meeting_title VARCHAR(200),
    meeting_type VARCHAR(20),

    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,

    status VARCHAR(20)
        CHECK (status IN ('ACTIVE', 'CANCELLED')),

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_schedule_booking
        FOREIGN KEY (booking_id)
        REFERENCES bookings(booking_id),

    CONSTRAINT fk_schedule_room
        FOREIGN KEY (room_id)
        REFERENCES meeting_rooms(room_id),

    CONSTRAINT fk_schedule_user
        FOREIGN KEY (booked_by)
        REFERENCES users(user_id)
);


CREATE TABLE manager_credit_summary (
    user_id UUID PRIMARY KEY,

    manager_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) NOT NULL,

    total_credits INTEGER NOT NULL,
    last_reset_at TIMESTAMP,

    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_manager_summary_user
        FOREIGN KEY (user_id)
        REFERENCES users(user_id)
);


CREATE TABLE amenities (
    amenity_id UUID PRIMARY KEY,
    amenity_name VARCHAR(50) UNIQUE NOT NULL,
    credit_cost INTEGER NOT NULL CHECK (credit_cost >= 0)
);

Dummy Data: INSERT INTO amenities (amenity_name, credit_cost) VALUES
('PROJECTOR', 5),
('WIFI', 10),
('CONFERENCE_CALL', 15),
('WHITEBOARD', 5),
('WATER_DISPENSER', 5),
('TV', 10),
('COFFEE_MACHINE', 10);

CREATE TABLE seating_capacity_credits (
    min_capacity INTEGER NOT NULL,
    max_capacity INTEGER NOT NULL,
    credit_cost INTEGER NOT NULL,

    CONSTRAINT pk_seating_capacity PRIMARY KEY (min_capacity, max_capacity)
);

Dummy data: INSERT INTO seating_capacity_credits VALUES
(0, 5, 0),
(6, 10, 10),
(11, 1000, 20);


How to use in service layer.
1. Fetch room seating capacity
2. Fetch seating capacity credit
3. Fetch all amenities for the room
4. Sum all amenity credits
5. hourlyCost = seatingCost + amenityCost
6. totalCost = hourlyCost Ã— duration

