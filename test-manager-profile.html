<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Manager Profile API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #2563EB;
        }
        pre {
            background: #1F2937;
            color: #10B981;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 14px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #D1FAE5; color: #065F46; }
        .error { background: #FEE2E2; color: #991B1B; }
        .info { background: #DBEAFE; color: #1E40AF; }
    </style>
</head>
<body>
    <h1>üß™ Manager Profile API Test</h1>
    
    <div class="test-section">
        <h2>Test Configuration</h2>
        <p><strong>API Base URL:</strong> <code id="apiUrl">http://localhost:8081/api</code></p>
        <p><strong>Profile Endpoint:</strong> <code>/manager/profile</code></p>
        <p><strong>Full URL:</strong> <code id="fullUrl">http://localhost:8081/api/manager/profile</code></p>
    </div>

    <div class="test-section">
        <h2>Run Test</h2>
        <button onclick="testManagerProfile()">üöÄ Test Manager Profile API</button>
        <button onclick="clearResults()">üßπ Clear Results</button>
    </div>

    <div class="test-section">
        <h2>Console Logs</h2>
        <div id="consoleOutput"></div>
    </div>

    <div class="test-section">
        <h2>API Response</h2>
        <div id="results"></div>
    </div>

    <script src="./js/api.js"></script>
    <script>
        // Intercept console.log
        const consoleOutput = document.getElementById('consoleOutput');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addConsoleMessage(type, ...args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            
            const div = document.createElement('div');
            div.className = 'status ' + (type === 'error' ? 'error' : type === 'warn' ? 'info' : 'success');
            div.textContent = `[${type.toUpperCase()}] ${message}`;
            consoleOutput.appendChild(div);
            
            // Also log to real console
            if (type === 'error') originalError.apply(console, args);
            else if (type === 'warn') originalWarn.apply(console, args);
            else originalLog.apply(console, args);
        }

        console.log = (...args) => addConsoleMessage('log', ...args);
        console.error = (...args) => addConsoleMessage('error', ...args);
        console.warn = (...args) => addConsoleMessage('warn', ...args);

        async function testManagerProfile() {
            const results = document.getElementById('results');
            results.innerHTML = '<p class="status info">‚è≥ Testing API connection...</p>';
            
            console.log('üîÑ Starting manager profile test...');
            
            try {
                // Test 1: Check if API is reachable
                console.log('üì° Test 1: Checking if backend is reachable...');
                const healthCheck = await fetch('http://localhost:8081/api/manager/profile')
                    .catch(err => {
                        throw new Error(`Cannot connect to backend: ${err.message}`);
                    });
                
                console.log('‚úÖ Backend is reachable!');
                console.log('Response status:', healthCheck.status);
                
                // Test 2: Call getManagerProfile function
                console.log('üì° Test 2: Calling getManagerProfile()...');
                const profile = await getManagerProfile();
                
                console.log('‚úÖ Profile received successfully!');
                
                // Display results
                results.innerHTML = `
                    <div class="status success">
                        <h3>‚úÖ SUCCESS! Profile loaded</h3>
                    </div>
                    <h3>Profile Data:</h3>
                    <pre>${JSON.stringify(profile, null, 2)}</pre>
                    
                    <h3>Breakdown:</h3>
                    <ul>
                        <li><strong>Name:</strong> ${profile.name || 'N/A'}</li>
                        <li><strong>Email:</strong> ${profile.email || 'N/A'}</li>
                        <li><strong>Role:</strong> ${profile.role || 'N/A'}</li>
                        <li><strong>Available Credits:</strong> ${profile.availableCredits !== undefined ? profile.availableCredits : 'N/A'}</li>
                        <li><strong>User ID:</strong> ${profile.userId || 'N/A'}</li>
                    </ul>
                `;
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                results.innerHTML = `
                    <div class="status error">
                        <h3>‚ùå ERROR!</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                    <h3>Error Details:</h3>
                    <pre>${error.stack || 'No stack trace'}</pre>
                    
                    <h3>Troubleshooting:</h3>
                    <ul>
                        <li>‚úì Is your backend server running on port 8081?</li>
                        <li>‚úì Can you access http://localhost:8081/api/manager/profile directly?</li>
                        <li>‚úì Check CORS settings on backend</li>
                        <li>‚úì Check backend console for errors</li>
                    </ul>
                `;
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('consoleOutput').innerHTML = '';
            console.log('‚ú® Results cleared');
        }

        // Auto-test on page load
        console.log('üìÑ Test page loaded successfully');
        console.log('üëâ Click "Test Manager Profile API" button to start testing');
    </script>
</body>
</html>
