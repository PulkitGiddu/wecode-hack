<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Management Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #3B82F6;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #3B82F6;
            color: white;
        }
        .btn-primary:hover {
            background: #2563EB;
        }
        .btn-secondary {
            background: #6B7280;
            color: white;
        }
        .btn-secondary:hover {
            background: #4B5563;
        }
        .btn-success {
            background: #10B981;
            color: white;
        }
        .btn-success:hover {
            background: #059669;
        }
        .status {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: 600;
        }
        .status.dummy {
            background: #FEF3C7;
            color: #92400E;
            border-left: 4px solid #F59E0B;
        }
        .status.backend {
            background: #D1FAE5;
            color: #065F46;
            border-left: 4px solid #10B981;
        }
        .data-display {
            background: #F9FAFB;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #E5E7EB;
            max-height: 400px;
            overflow-y: auto;
        }
        .room-card, .amenity-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .room-card h3, .amenity-card h3 {
            margin: 0 0 10px 0;
            color: #1F2937;
        }
        .room-info, .amenity-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .info-item {
            display: flex;
            flex-direction: column;
        }
        .info-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 600;
            text-transform: uppercase;
        }
        .info-value {
            font-size: 14px;
            color: #1F2937;
            margin-top: 2px;
        }
        .amenities-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .amenity-tag {
            background: #DBEAFE;
            color: #1E40AF;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .cost-badge {
            background: #10B981;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        pre {
            background: #1F2937;
            color: #F9FAFB;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ BookIt - Data Management Test</h1>
        
        <div id="status" class="status dummy">
            üìä Current Data Source: <span id="dataSource">Checking...</span>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="loadRooms()">üìã Load Rooms</button>
            <button class="btn-primary" onclick="loadAmenities()">üéØ Load Amenities</button>
            <button class="btn-secondary" onclick="toggleDataSource()">üîÑ Toggle Data Source</button>
            <button class="btn-success" onclick="testCalculation()">üí∞ Test Cost Calculation</button>
        </div>

        <h2>Rooms Data</h2>
        <div id="roomsData" class="data-display">
            Click "Load Rooms" to fetch data
        </div>

        <h2>Amenities Data</h2>
        <div id="amenitiesData" class="data-display">
            Click "Load Amenities" to fetch data
        </div>

        <h2>Test Results</h2>
        <div id="testResults" class="data-display">
            Click "Test Cost Calculation" to run tests
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // Update status on load
        window.addEventListener('load', function() {
            updateStatus();
        });

        function updateStatus() {
            const source = getDataSource();
            const statusEl = document.getElementById('status');
            const sourceEl = document.getElementById('dataSource');
            
            sourceEl.textContent = source.toUpperCase();
            statusEl.className = `status ${source}`;
            
            if (source === 'dummy') {
                statusEl.innerHTML = 'üìä Current Data Source: <span id="dataSource">DUMMY DATA</span> (Testing/Development Mode)';
            } else {
                statusEl.innerHTML = 'üìä Current Data Source: <span id="dataSource">BACKEND API</span> (Production Mode)';
            }
        }

        async function loadRooms() {
            try {
                const rooms = await getAllRooms();
                displayRooms(rooms);
            } catch (error) {
                document.getElementById('roomsData').innerHTML = `
                    <div style="color: #DC2626; font-weight: 600;">
                        ‚ùå Error loading rooms: ${error.message}
                    </div>
                `;
            }
        }

        function displayRooms(rooms) {
            const container = document.getElementById('roomsData');
            
            if (!rooms || rooms.length === 0) {
                container.innerHTML = '<p>No rooms found</p>';
                return;
            }

            container.innerHTML = rooms.map(room => `
                <div class="room-card">
                    <h3>üè† ${room.roomName}</h3>
                    <div class="room-info">
                        <div class="info-item">
                            <span class="info-label">Room Type</span>
                            <span class="info-value">${room.roomType}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Capacity</span>
                            <span class="info-value">${room.seatingCapacity} people</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Base Cost</span>
                            <span class="info-value">$${room.perHourCost}/hour</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Cost</span>
                            <span class="info-value"><span class="cost-badge">$${room.roomCost}/hour</span></span>
                        </div>
                    </div>
                    <div class="amenities-list">
                        ${room.amenities.map(a => `<span class="amenity-tag">${formatAmenityName(a)}</span>`).join('')}
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: #6B7280;">
                        Room ID: ${room.roomId}
                    </div>
                </div>
            `).join('');
        }

        async function loadAmenities() {
            try {
                const amenities = await getAllAmenities();
                displayAmenities(amenities);
            } catch (error) {
                document.getElementById('amenitiesData').innerHTML = `
                    <div style="color: #DC2626; font-weight: 600;">
                        ‚ùå Error loading amenities: ${error.message}
                    </div>
                `;
            }
        }

        function displayAmenities(amenities) {
            const container = document.getElementById('amenitiesData');
            
            if (!amenities || amenities.length === 0) {
                container.innerHTML = '<p>No amenities found</p>';
                return;
            }

            container.innerHTML = amenities.map(amenity => `
                <div class="amenity-card">
                    <h3>üéØ ${formatAmenityName(amenity.amenityName)}</h3>
                    <div class="amenity-info">
                        <div class="info-item">
                            <span class="info-label">Credit Cost</span>
                            <span class="info-value"><span class="cost-badge">$${amenity.creditCost}</span></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status</span>
                            <span class="info-value">${amenity.is_active ? '‚úÖ Active' : '‚ùå Inactive'}</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: #6B7280;">
                        Amenity ID: ${amenity.amenity_id}
                    </div>
                </div>
            `).join('');
        }

        function toggleDataSource() {
            const currentSource = getDataSource();
            const newSource = currentSource === 'dummy';
            setDataSource(newSource);
            updateStatus();
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10B981;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
            `;
            notification.textContent = `‚úÖ Switched to ${getDataSource().toUpperCase()}`;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        function testCalculation() {
            const tests = [
                {
                    name: 'Bhimtal Room',
                    baseCost: 100,
                    amenities: ['COFFEE_MACHINE', 'WIFI'],
                    expected: 120
                },
                {
                    name: 'Nainital Room',
                    baseCost: 200,
                    amenities: ['PROJECTOR', 'WIFI', 'WHITEBOARD', 'CONFERENCE_CALL'],
                    expected: 235
                },
                {
                    name: 'No Amenities',
                    baseCost: 50,
                    amenities: [],
                    expected: 50
                }
            ];

            const results = tests.map(test => {
                const calculated = calculateRoomCost(test.baseCost, test.amenities);
                const passed = calculated === test.expected;
                
                return {
                    ...test,
                    calculated,
                    passed
                };
            });

            const resultsHTML = `
                <h3>Cost Calculation Tests</h3>
                ${results.map(r => `
                    <div style="padding: 10px; margin: 10px 0; background: ${r.passed ? '#D1FAE5' : '#FEE2E2'}; border-radius: 5px; border-left: 4px solid ${r.passed ? '#10B981' : '#DC2626'};">
                        <strong>${r.passed ? '‚úÖ' : '‚ùå'} ${r.name}</strong><br>
                        Base Cost: $${r.baseCost}<br>
                        Amenities: ${r.amenities.join(', ') || 'None'}<br>
                        Expected: $${r.expected} | Calculated: $${r.calculated}
                    </div>
                `).join('')}
                
                <h3 style="margin-top: 30px;">Sample Data</h3>
                <pre>${JSON.stringify({
                    rooms: getDummyRooms().slice(0, 2),
                    amenities: getDummyAmenities().slice(0, 3)
                }, null, 2)}</pre>
            `;

            document.getElementById('testResults').innerHTML = resultsHTML;
        }
    </script>
</body>
</html>
